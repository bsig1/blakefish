//
// Created by blake on 7/17/25.
//

#include "eval_constants.h"


// Indexed by color, piece, then square
int piece_square_table_middlegame[2][6][64] = {
	{ // --WHITE--
    // Knight
		    {
		     -50, -40, -30, -30, -30, -30, -40, -50,
		     -40, -20,   0,   5,   5,   0, -20, -40,
		     -30,   5,  10,  15,  15,  10,   5, -30,
		     -30,   0,  15,  20,  20,  15,   0, -30,
		     -30,   5,  15,  20,  20,  15,   5, -30,
		     -30,   0,  10,  15,  15,  10,   0, -30,
		     -40, -20,   0,   0,   0,   0, -20, -40,
		     -50, -40, -30, -30, -30, -30, -40, -50
		    },
		    // Bishop
		    {
		     -20, -10, -10, -10, -10, -10, -10, -20,
		     -10,   0,   0,   0,   0,   0,   0, -10,
		     -10,   0,   5,  10,  10,   5,   0, -10,
		     -10,   5,   5,  10,  10,   5,   5, -10,
		     -10,   0,  10,  10,  10,  10,   0, -10,
		     -10,  10,  10,  10,  10,  10,  10, -10,
		     -10,   5,   0,   0,   0,   0,   5, -10,
		     -20, -10, -10, -10, -10, -10, -10, -20
		    },
			// Queen
		{
			-20, -10, -10,  -5,  -5, -10, -10, -20,
			-10,   0,   0,   0,   0,   0,   0, -10,
			-10,   0,   5,   5,   5,   5,   0, -10,
			 -5,   0,   5,   5,   5,   5,   0,  -5,
			   0,   0,   5,   5,   5,   5,   0,  -5,
			-10,   5,   5,   5,   5,   5,   0, -10,
			-10,   0,   5,   0,   0,   0,   0, -10,
			-20, -10, -10,  -5,  -5, -10, -10, -20
		   },
		    // Rook
		    {
		        0,   0,   0,   0,   0,   0,   0,   0,
		        5,  10,  10,  10,  10,  10,  10,   5,
		       -5,   0,   0,   0,   0,   0,   0,  -5,
		       -5,   0,   0,   0,   0,   0,   0,  -5,
		       -5,   0,   0,   0,   0,   0,   0,  -5,
		       -5,   0,   0,   0,   0,   0,   0,  -5,
		       -5,   0,   0,   0,   0,   0,   0,  -5,
		        0,   0,   0,   5,   5,   0,   0,   0
		    },
		    // King (middle‐game)
		    {
		     -30, -40, -40, -50, -50, -40, -40, -30,
		     -30, -40, -40, -50, -50, -40, -40, -30,
		     -30, -40, -40, -50, -50, -40, -40, -30,
		     -30, -40, -40, -50, -50, -40, -40, -30,
		     -20, -30, -30, -40, -40, -30, -30, -20,
		     -10, -20, -20, -20, -20, -20, -20, -10,
		      20,  20,   0,   0,   0,   0,  20,  20,
		      20,  30,  10,   0,   0,  10,  30,  20
		    },
			// Pawn
		{
			0,   0,   0,   0,   0,   0,   0,   0,
		   50,  50,  50,  50,  50,  50,  50,  50,
		   10,  10,  20,  30,  30,  20,  10,  10,
			5,   5,  10,  25,  25,  10,   5,   5,
			0,   0,   0,  20,  20,   0,   0,   0,
			5,  -5, -10,   0,   0, -10,  -5,   5,
			5,  10,  10, -20, -20,  10,  10,   5,
			0,   0,   0,   0,   0,   0,   0,   0
		 },
	},		//--BLACK--
	 {
	    // Knight
	    {
	      -50,  -40,  -30,  -30,  -30,  -30,  -40,  -50,
	      -40,  -20,    0,    0,    0,    0,  -20,  -40,
	      -30,    0,   10,   15,   15,   10,    0,  -30,
	      -30,    5,   15,   20,   20,   15,    5,  -30,
	      -30,    0,   15,   20,   20,   15,    0,  -30,
	      -30,    5,   10,   15,   15,   10,    5,  -30,
	      -40,  -20,    0,    5,    5,    0,  -20,  -40,
	      -50,  -40,  -30,  -30,  -30,  -30,  -40,  -50
	    },
	    // Bishop
	    {
	      -20,  -10,  -10,  -10,  -10,  -10,  -10,  -20,
	      -10,    5,    0,    0,    0,    0,    5,  -10,
	      -10,   10,   10,   10,   10,   10,   10,  -10,
	      -10,    0,   10,   10,   10,   10,    0,  -10,
	      -10,    5,    5,   10,   10,    5,    5,  -10,
	      -10,    0,    5,   10,   10,    5,    0,  -10,
	      -10,    0,    0,    0,    0,    0,    0,  -10,
	      -20,  -10,  -10,  -10,  -10,  -10,  -10,  -20
	    },
	    // Queen
	    {
	      -20,  -10,  -10,   -5,   -5,  -10,  -10,  -20,
	      -10,    0,    5,    0,    0,    0,    0,  -10,
	      -10,    5,    5,    5,    5,    5,    0,  -10,
	        0,    0,    5,    5,    5,    5,    0,   -5,
	       -5,    0,    5,    5,    5,    5,    0,   -5,
	      -10,    0,    5,    5,    5,    5,    0,  -10,
	      -10,    0,    0,    0,    0,    0,    0,  -10,
	      -20,  -10,  -10,   -5,   -5,  -10,  -10,  -20
	    },
	    // Rook
	    {
	        0,    0,    0,    5,    5,    0,    0,    0,
	       -5,    0,    0,    0,    0,    0,    0,   -5,
	       -5,    0,    0,    0,    0,    0,    0,   -5,
	       -5,    0,    0,    0,    0,    0,    0,   -5,
	       -5,    0,    0,    0,    0,    0,    0,   -5,
	       -5,    0,    0,    0,    0,    0,    0,   -5,
	        5,   10,   10,   10,   10,   10,   10,    5,
	        0,    0,    0,    0,    0,    0,    0,    0
	    },
	    // King (middle‐game)
	    {
	       20,   30,   10,    0,    0,   10,   30,   20,
	       20,   20,    0,    0,    0,    0,   20,   20,
	      -10,  -20,  -20,  -20,  -20,  -20,  -20,  -10,
	      -20,  -30,  -30,  -40,  -40,  -30,  -30,  -20,
	      -30,  -40,  -40,  -50,  -50,  -40,  -40,  -30,
	      -30,  -40,  -40,  -50,  -50,  -40,  -40,  -30,
	      -30,  -40,  -40,  -50,  -50,  -40,  -40,  -30,
	      -30,  -40,  -40,  -50,  -50,  -40,  -40,  -30
	    },
	    // Pawn
	    {
	        0,    0,    0,    0,    0,    0,    0,    0,
	        5,   10,   10,  -20,  -20,   10,   10,    5,
	        5,   -5,  -10,    0,    0,  -10,   -5,    5,
	        0,    0,    0,   20,   20,    0,    0,    0,
	        5,    5,   10,   25,   25,   10,    5,    5,
	       10,   10,   20,   30,   30,   20,   10,   10,
	       50,   50,   50,   50,   50,   50,   50,   50,
	        0,    0,    0,    0,    0,    0,    0,    0
	    }
	}
};

int piece_square_table_endgame[2][6][64] = {
    { // --WHITE--
        // 0: Knight
        {
         -50, -40, -30, -30, -30, -30, -40, -50,
         -40, -20,   0,   5,   5,   0, -20, -40,
         -30,   5,  10,  15,  15,  10,   5, -30,
         -30,   0,  15,  20,  20,  15,   0, -30,
         -30,   5,  15,  20,  20,  15,   5, -30,
         -30,   0,  10,  15,  15,  10,   0, -30,
         -40, -20,   0,   0,   0,   0, -20, -40,
         -50, -40, -30, -30, -30, -30, -40, -50
        },
        // 1: Bishop
        {
         -20, -10, -10, -10, -10, -10, -10, -20,
         -10,   0,   0,   0,   0,   0,   0, -10,
         -10,   0,   5,  10,  10,   5,   0, -10,
         -10,   5,   5,  10,  10,   5,   5, -10,
         -10,   0,  10,  10,  10,  10,   0, -10,
         -10,  10,  10,  10,  10,  10,  10, -10,
         -10,   5,   0,   0,   0,   0,   5, -10,
         -20, -10, -10, -10, -10, -10, -10, -20
        },
        // 2: Queen
        {
         -20, -10, -10,  -5,  -5, -10, -10, -20,
         -10,   0,   0,   0,   0,   0,   0, -10,
         -10,   0,   5,   5,   5,   5,   0, -10,
          -5,   0,   5,   5,   5,   5,   0,  -5,
           0,   0,   5,   5,   5,   5,   0,  -5,
         -10,   5,   5,   5,   5,   5,   0, -10,
         -10,   0,   5,   0,   0,   0,   0, -10,
         -20, -10, -10,  -5,  -5, -10, -10, -20
        },
        // 3: Rook
        {
           0,   0,   0,   0,   0,   0,   0,   0,
           5,  10,  10,  10,  10,  10,  10,   5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
           0,   0,   0,   0,   0,   0,   0,   0
        },
        // 4: King (endgame)
        {
         -50, -30, -30, -30, -30, -30, -30, -50,
         -30, -10,   0,   0,   0,   0, -10, -30,
         -30,   0,  10,  15,  15,  10,   0, -30,
         -30,   0,  15,  20,  20,  15,   0, -30,
         -30,   0,  15,  20,  20,  15,   0, -30,
         -30,   0,  10,  15,  15,  10,   0, -30,
         -30, -10,   0,   0,   0,   0, -10, -30,
         -50, -30, -30, -30, -30, -30, -30, -50
        },
        // 5: Pawn (endgame: reward advancement)
        {
           0,   0,   0,   0,   0,   0,   0,   0,
           5,   5,   5,   5,   5,   5,   5,   5,
          10,  10,  10,  10,  10,  10,  10,  10,
          20,  20,  20,  20,  20,  20,  20,  20,
          30,  30,  30,  30,  30,  30,  30,  30,
          40,  40,  40,  40,  40,  40,  40,  40,
          50,  50,  50,  50,  50,  50,  50,  50,
           0,   0,   0,   0,   0,   0,   0,   0
        }
    },
    { // --BLACK--  (just the mirror of the white tables)
        // Knight
        {
         -50, -40, -30, -30, -30, -30, -40, -50,
         -40, -20,   0,   0,   0,   0, -20, -40,
         -30,   0,  10,  15,  15,  10,   0, -30,
         -30,   5,  15,  20,  20,  15,   5, -30,
         -30,   0,  15,  20,  20,  15,   0, -30,
         -30,   5,  10,  15,  15,  10,   5, -30,
         -40, -20,   0,   5,   5,   0, -20, -40,
         -50, -40, -30, -30, -30, -30, -40, -50
        },
        // Bishop
        {
         -20, -10, -10, -10, -10, -10, -10, -20,
         -10,   5,   0,   0,   0,   0,   5, -10,
         -10,  10,  10,  10,  10,  10,  10, -10,
         -10,   0,  10,  10,  10,  10,   0, -10,
         -10,   5,   5,  10,  10,   5,   5, -10,
         -10,   0,   5,  10,  10,   5,   0, -10,
         -10,   0,   0,   0,   0,   0,   0, -10,
         -20, -10, -10, -10, -10, -10, -10, -20
        },
        // Queen
        {
         -20, -10, -10,  -5,  -5, -10, -10, -20,
         -10,   0,   5,   0,   0,   0,   0, -10,
         -10,   5,   5,   5,   5,   5,   0, -10,
           0,   0,   5,   5,   5,   5,   0,  -5,
          -5,   0,   5,   5,   5,   5,   0,  -5,
         -10,   5,   5,   5,   5,   5,   0, -10,
         -10,   0,   5,   0,   0,   0,   0, -10,
         -20, -10, -10,  -5,  -5, -10, -10, -20
        },
        // Rook
        {
           0,   0,   0,   0,   0,   0,   0,   0,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
          -5,   0,   0,   0,   0,   0,   0,  -5,
           5,  10,  10,  10,  10,  10,  10,   5,
           0,   0,   0,   0,   0,   0,   0,   0
        },
        // King (endgame)
        {
         -50, -30, -30, -30, -30, -30, -30, -50,
         -30, -10,   0,   0,   0,   0, -10, -30,
         -30,   0,  10,  15,  15,  10,   0, -30,
         -30,   0,  15,  20,  20,  15,   0, -30,
         -30,   0,  15,  20,  20,  15,   0, -30,
         -30,   0,  10,  15,  15,  10,   0, -30,
         -30, -10,   0,   0,   0,   0, -10, -30,
         -50, -30, -30, -30, -30, -30, -30, -50
        },
        // Pawn (endgame)
        {
           0,   0,   0,   0,   0,   0,   0,   0,
          50,  50,  50,  50,  50,  50,  50,  50,
          40,  40,  40,  40,  40,  40,  40,  40,
          30,  30,  30,  30,  30,  30,  30,  30,
          20,  20,  20,  20,  20,  20,  20,  20,
          10,  10,  10,  10,  10,  10,  10,  10,
           5,   5,   5,   5,   5,   5,   5,   5,
           0,   0,   0,   0,   0,   0,   0,   0
        }
    }
};

int knight_outpost_bonus[2][64] = {
	{ // WHITE
		0,   0,   0,   0,   0,   0,   0,   0,
		0,   0,   0,   0,   0,   0,   0,   0,
		0,   5,  10,  10,  10,  10,   5,   0,
		0,  10,  20,  30,  30,  20,  10,   0,
		0,  10,  20,  30,  30,  20,  10,   0,
		0,   5,  10,  10,  10,  10,   5,   0,
		0,   0,   0,   0,   0,   0,   0,   0,
		0,   0,   0,   0,   0,   0,   0,   0
	},{
		// BLACK  (mirror of WHITE)
		0,   0,   0,   0,   0,   0,   0,   0,
		0,   0,   0,   0,   0,   0,   0,   0,
		0,   0,   0,   0,   0,   0,   0,   0,
		0,   5,  10,  10,  10,  10,   5,   0,
		0,  10,  20,  30,  30,  20,  10,   0,
		0,  10,  20,  30,  30,  20,  10,   0,
		0,   5,  10,  10,  10,  10,   5,   0,
		0,   0,   0,   0,   0,   0,   0,   0
	}
};

int passed_bonus[2][8] = {
	{
	0,    // rank1 (sq/8=0) — not in play
	20,   // rank2
	40,   // rank3
	60,   // rank4
	80,   // rank5
	100,  // rank6
	120,  // rank7
	0     // rank8 (already promoted)
	},
	// Black
	 {
	0,   // rank1 (promoted)
	120,  // rank2 (from black’s perspective, sq/8=1)
	100,  // rank3
	80,   // rank4
	60,   // rank5
	40,   // rank6
	20,   // rank7
	0     // rank8
	 }
};

U64 knight_outpost_defenders[2][64];
U64 knight_outpost_attackers[2][64];

void init_outpost_masks() {
	for (int square = 0; square < 64; ++square) {
		const int file = square % 8;
		const int rank = square / 8;

		knight_outpost_attackers[White][square] = 0ULL;
		knight_outpost_attackers[Black][square] = 0ULL;
		knight_outpost_defenders[White][square]  = 0ULL;
		knight_outpost_defenders[Black][square]  = 0ULL;

		// Knight outpost immunity: cannot be attacked by enemy pawns

		// For White outposts: enemy black pawns attack from ahead (rank +1)
		if (rank <= 5) {
			if (file > 0) knight_outpost_attackers[White][square] |= 1ULL << (square + 7);
			if (file < 7) knight_outpost_attackers[White][square] |= 1ULL << (square + 9);
		}

		// For Black outposts: enemy white pawns attack from behind (rank -1)
		if (rank >= 2) {
			if (file > 0) knight_outpost_attackers[Black][square] |= 1ULL << (square - 9);
			if (file < 7) knight_outpost_attackers[Black][square] |= 1ULL << (square - 7);
		}

		// Knight guard squares: protected by friendly pawn from behind

		// White pawns guard from rank -1
		if (rank > 0)
			knight_outpost_defenders[White][square] = 1ULL << (square - 8);

		// Black pawns guard from rank +1
		if (rank < 7)
			knight_outpost_defenders[Black][square] = 1ULL << (square + 8);
	}
}
;
